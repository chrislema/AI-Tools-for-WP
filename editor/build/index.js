(()=>{"use strict";var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.plugins,i=window.wp.editPost,s=window.wp.i18n,n=window.wp.primitives,o=window.ReactJSXRuntime;var a=(0,o.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,o.jsx)(n.Path,{d:"M11.776 4.454a.25.25 0 01.448 0l2.069 4.192a.25.25 0 00.188.137l4.626.672a.25.25 0 01.139.426l-3.348 3.263a.25.25 0 00-.072.222l.79 4.607a.25.25 0 01-.362.263l-4.138-2.175a.25.25 0 00-.232 0l-4.138 2.175a.25.25 0 01-.363-.263l.79-4.607a.25.25 0 00-.071-.222L4.754 9.881a.25.25 0 01.139-.426l4.626-.672a.25.25 0 00.188-.137l2.069-4.192z"})});const r=window.wp.data,l="aitwp/editor",c={selectedAudienceId:"",audiences:[],voiceProfiles:[],isLoadingAudiences:!1,isLoadingProfiles:!1},d="SET_SELECTED_AUDIENCE",u="SET_AUDIENCES",p="SET_VOICE_PROFILES",g="SET_LOADING_AUDIENCES",w="SET_LOADING_PROFILES",h={setSelectedAudience:e=>({type:d,audienceId:e}),setAudiences:e=>({type:u,audiences:e}),setVoiceProfiles:e=>({type:p,profiles:e}),setLoadingAudiences:e=>({type:g,isLoading:e}),setLoadingProfiles:e=>({type:w,isLoading:e})},_=(0,r.createReduxStore)(l,{reducer:function(e=c,t){switch(t.type){case d:return{...e,selectedAudienceId:t.audienceId};case u:return{...e,audiences:t.audiences};case p:return{...e,voiceProfiles:t.profiles};case g:return{...e,isLoadingAudiences:t.isLoading};case w:return{...e,isLoadingProfiles:t.isLoading};default:return e}},actions:h,selectors:{getSelectedAudienceId:e=>e.selectedAudienceId,getSelectedAudience:e=>e.selectedAudienceId&&e.audiences.find(t=>t.id===e.selectedAudienceId)||null,getAudiences:e=>e.audiences,getVoiceProfiles:e=>e.voiceProfiles,isLoadingAudiences:e=>e.isLoadingAudiences,isLoadingProfiles:e=>e.isLoadingProfiles}});(0,r.register)(_);const f=window.wp.element,m=window.wp.components;class x extends f.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t}),console.error("AI Tools Error:",e),console.error("Component Stack:",t?.componentStack)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){const{hasError:e,error:t}=this.state,{children:i,fallback:n,panelTitle:a}=this.props;return e?n||(0,o.jsxs)("div",{className:"aitwp-error-boundary",children:[(0,o.jsxs)(m.Notice,{status:"error",isDismissible:!1,children:[(0,o.jsx)("p",{children:(0,o.jsx)("strong",{children:a?sprintf(/* translators: %s: panel title */ /* translators: %s: panel title */
(0,s.__)("%s encountered an error.","ai-tools-for-wp"),a):(0,s.__)("Something went wrong.","ai-tools-for-wp")})}),t?.message&&(0,o.jsx)("p",{className:"aitwp-error-message",children:t.message})]}),(0,o.jsx)(m.Button,{variant:"secondary",onClick:this.handleRetry,className:"aitwp-retry-button",children:(0,s.__)("Try Again","ai-tools-for-wp")})]}):i}}const j=x,S=window.wp.apiFetch;var y=e.n(S);const A="/ai-tools/v1",v=()=>{const[e,t]=(0,f.useState)(!1),[i,n]=(0,f.useState)(null),[a,c]=(0,f.useState)(null),{audiences:d,selectedAudienceId:u,isLoading:p}=(0,r.useSelect)(e=>{const t=e(l);return{audiences:t.getAudiences(),selectedAudienceId:t.getSelectedAudienceId(),isLoading:t.isLoadingAudiences()}},[]),g=(0,r.useSelect)(e=>{const{getEditedPostContent:t}=e("core/editor");return t()},[]),{setSelectedAudience:w,setAudiences:h,setLoadingAudiences:_}=(0,r.useDispatch)(l);(0,f.useEffect)(()=>{x()},[]);const x=async()=>{try{_(!0),c(null);const e=await(async()=>y()({path:`${A}/audiences`,method:"GET"}))(),t=Object.values(e||{});h(t)}catch(e){c(e.message||(0,s.__)("Failed to load audiences.","ai-tools-for-wp"))}finally{_(!1)}};return p?(0,o.jsx)(m.PanelBody,{title:(0,s.__)("Target Audience","ai-tools-for-wp"),initialOpen:!0,children:(0,o.jsxs)("div",{className:"aitwp-loading",children:[(0,o.jsx)(m.Spinner,{}),(0,o.jsx)("span",{children:(0,s.__)("Loading audiences...","ai-tools-for-wp")})]})}):0===d.length?(0,o.jsx)(m.PanelBody,{title:(0,s.__)("Target Audience","ai-tools-for-wp"),initialOpen:!0,children:(0,o.jsx)(m.Notice,{status:"info",isDismissible:!1,children:(0,s.__)("No audiences defined. Add audiences in Settings → AI Tools.","ai-tools-for-wp")})}):(0,o.jsxs)(m.PanelBody,{title:(0,s.__)("Target Audience","ai-tools-for-wp"),initialOpen:!0,children:[a&&(0,o.jsx)(m.Notice,{status:"error",isDismissible:!0,onDismiss:()=>c(null),children:a}),(0,o.jsx)(m.SelectControl,{label:(0,s.__)("Select Audience","ai-tools-for-wp"),value:u,options:(()=>{const e=[{value:"",label:(0,s.__)("— Select Audience —","ai-tools-for-wp")}];return d.forEach(t=>{e.push({value:t.id,label:t.name})}),e})(),onChange:e=>{w(e),n(null)}}),(0,o.jsx)(m.Button,{variant:"secondary",onClick:async()=>{if(!g||g.trim().length<50)c((0,s.__)("Please add more content before requesting a suggestion.","ai-tools-for-wp"));else try{t(!0),c(null),n(null);const e=await(async e=>y()({path:`${A}/suggest-audience`,method:"POST",data:{content:e}}))(g);n(e),e.audience_id&&w(e.audience_id)}catch(e){c(e.message||(0,s.__)("Failed to get suggestion.","ai-tools-for-wp"))}finally{t(!1)}},disabled:e,className:"aitwp-suggest-button",children:e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(m.Spinner,{}),(0,s.__)("Analyzing...","ai-tools-for-wp")]}):(0,s.__)("Suggest Audience","ai-tools-for-wp")}),i&&(0,o.jsxs)("div",{className:"aitwp-suggestion",children:[(0,o.jsx)("p",{className:"aitwp-suggestion-label",children:(0,s.__)("AI Suggestion:","ai-tools-for-wp")}),(0,o.jsxs)("p",{className:"aitwp-suggestion-value",children:[(0,o.jsx)("strong",{children:i.audience?.name}),i.confidence&&(0,o.jsx)("span",{className:"aitwp-confidence",children:` (${i.confidence}% match)`})]}),i.reasoning&&(0,o.jsx)("p",{className:"aitwp-suggestion-reasoning",children:i.reasoning})]})]})},C=()=>{const[e,t]=(0,f.useState)(!1),[i,n]=(0,f.useState)(null),[a,c]=(0,f.useState)([]),[d,u]=(0,f.useState)([]),[p,g]=(0,f.useState)(window.aitwpData?.autoApply||!1),[w,h]=(0,f.useState)(null),{postContent:_,currentCategories:x,currentTags:j,selectedAudienceId:S}=(0,r.useSelect)(e=>{const t=e("core/editor"),i=e(l);return{postContent:t.getEditedPostContent(),currentCategories:t.getEditedPostAttribute("categories")||[],currentTags:t.getEditedPostAttribute("tags")||[],selectedAudienceId:i.getSelectedAudienceId()}},[]),{editPost:v}=(0,r.useDispatch)("core/editor");return(0,o.jsxs)(m.PanelBody,{title:(0,s.__)("Auto-Categorize","ai-tools-for-wp"),initialOpen:!1,children:[w&&(0,o.jsx)(m.Notice,{status:"error",isDismissible:!0,onDismiss:()=>h(null),children:w}),(0,o.jsx)("p",{className:"aitwp-panel-description",children:(0,s.__)("Analyze your content to get AI-suggested categories and tags.","ai-tools-for-wp")}),(0,o.jsx)(m.ToggleControl,{label:(0,s.__)("Auto-apply suggestions","ai-tools-for-wp"),checked:p,onChange:g,help:(0,s.__)("Automatically apply suggestions when analyzing.","ai-tools-for-wp")}),(0,o.jsx)(m.Button,{variant:"primary",onClick:async()=>{if(!_||_.trim().length<50)h((0,s.__)("Please add more content before analyzing.","ai-tools-for-wp"));else try{t(!0),h(null),n(null);const e=await(async(e,t="")=>y()({path:`${A}/categorize`,method:"POST",data:{content:e,audience_id:t}}))(_,S);n(e),c(e.categories?.map(e=>e.id)||[]),u(e.tags?.map(e=>e.id)||[]),p&&(e=>{const t=e.categories?.map(e=>e.id)||[],i=e.tags?.map(e=>e.id)||[],s=[...new Set([...x,...t])],n=[...new Set([...j,...i])];v({categories:s,tags:n})})(e)}catch(e){h(e.message||(0,s.__)("Failed to analyze content.","ai-tools-for-wp"))}finally{t(!1)}},disabled:e,className:"aitwp-analyze-button",children:e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(m.Spinner,{}),(0,s.__)("Analyzing...","ai-tools-for-wp")]}):(0,s.__)("Analyze Content","ai-tools-for-wp")}),i&&(0,o.jsxs)("div",{className:"aitwp-suggestions",children:[i.reasoning&&(0,o.jsx)("p",{className:"aitwp-reasoning",children:i.reasoning}),i.categories?.length>0&&(0,o.jsxs)("div",{className:"aitwp-suggestion-group",children:[(0,o.jsx)("h4",{children:(0,s.__)("Suggested Categories","ai-tools-for-wp")}),i.categories.map(e=>(0,o.jsx)(m.CheckboxControl,{label:e.name,checked:a.includes(e.id),onChange:()=>{return t=e.id,void c(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t}},e.id))]}),i.tags?.length>0&&(0,o.jsxs)("div",{className:"aitwp-suggestion-group",children:[(0,o.jsx)("h4",{children:(0,s.__)("Suggested Tags","ai-tools-for-wp")}),i.tags.map(e=>(0,o.jsx)(m.CheckboxControl,{label:e.name,checked:d.includes(e.id),onChange:()=>{return t=e.id,void u(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t}},e.id))]}),i.new_tags?.length>0&&(0,o.jsxs)("div",{className:"aitwp-suggestion-group",children:[(0,o.jsx)("h4",{children:(0,s.__)("Suggested New Tags","ai-tools-for-wp")}),(0,o.jsx)("p",{className:"aitwp-new-tags-note",children:(0,s.__)("These tags don't exist yet:","ai-tools-for-wp")}),(0,o.jsx)("ul",{className:"aitwp-new-tags-list",children:i.new_tags.map((e,t)=>(0,o.jsx)("li",{children:e},t))})]}),!p&&(0,o.jsxs)("div",{className:"aitwp-suggestion-actions",children:[(0,o.jsx)(m.Button,{variant:"primary",onClick:()=>{const e=[...new Set([...x,...a])],t=[...new Set([...j,...d])];v({categories:e,tags:t}),n(null)},disabled:0===a.length&&0===d.length,children:(0,s.__)("Apply Selected","ai-tools-for-wp")}),(0,o.jsx)(m.Button,{variant:"tertiary",onClick:()=>{n(null),c([]),u([])},children:(0,s.__)("Dismiss","ai-tools-for-wp")})]})]})]})},b=()=>{const[e,t]=(0,f.useState)([]),[i,n]=(0,f.useState)(""),[a,c]=(0,f.useState)(!0),[d,u]=(0,f.useState)(!1),[p,g]=(0,f.useState)(""),[w,h]=(0,f.useState)(!1),[_,x]=(0,f.useState)(null),{postContent:j,selectedAudienceId:S}=(0,r.useSelect)(e=>{const t=e(l);return{postContent:e("core/editor").getEditedPostContent(),selectedAudienceId:t.getSelectedAudienceId()}},[]),{editPost:v}=(0,r.useDispatch)("core/editor");(0,f.useEffect)(()=>{C()},[]);const C=async()=>{try{c(!0),x(null);const e=await(async()=>y()({path:`${A}/voice-profiles`,method:"GET"}))(),i=Object.values(e||{});t(i),i.length>0&&n(i[0].id)}catch(e){x(e.message||(0,s.__)("Failed to load voice profiles.","ai-tools-for-wp"))}finally{c(!1)}},b=()=>{h(!1),g("")};return a?(0,o.jsx)(m.PanelBody,{title:(0,s.__)("Rewrite Content","ai-tools-for-wp"),initialOpen:!1,children:(0,o.jsxs)("div",{className:"aitwp-loading",children:[(0,o.jsx)(m.Spinner,{}),(0,o.jsx)("span",{children:(0,s.__)("Loading voice profiles...","ai-tools-for-wp")})]})}):0===e.length?(0,o.jsx)(m.PanelBody,{title:(0,s.__)("Rewrite Content","ai-tools-for-wp"),initialOpen:!1,children:(0,o.jsx)(m.Notice,{status:"info",isDismissible:!1,children:(0,s.__)("No voice profiles defined. Add profiles in Settings → AI Tools.","ai-tools-for-wp")})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(m.PanelBody,{title:(0,s.__)("Rewrite Content","ai-tools-for-wp"),initialOpen:!1,children:[_&&(0,o.jsx)(m.Notice,{status:"error",isDismissible:!0,onDismiss:()=>x(null),children:_}),(0,o.jsx)("p",{className:"aitwp-panel-description",children:(0,s.__)("Rewrite your content using a voice profile to match your desired tone and style.","ai-tools-for-wp")}),(0,o.jsx)(m.SelectControl,{label:(0,s.__)("Voice Profile","ai-tools-for-wp"),value:i,options:e.map(e=>({value:e.id,label:e.name})),onChange:n}),(0,o.jsx)(m.Button,{variant:"primary",onClick:async()=>{if(!j||j.trim().length<50)x((0,s.__)("Please add more content before rewriting.","ai-tools-for-wp"));else if(i)try{u(!0),x(null),g("");const e=await(async(e,t,i="")=>y()({path:`${A}/rewrite`,method:"POST",data:{content:e,voice_profile_id:t,audience_id:i}}))(j,i,S);e.rewritten_content&&(g(e.rewritten_content),h(!0))}catch(e){x(e.message||(0,s.__)("Failed to rewrite content.","ai-tools-for-wp"))}finally{u(!1)}else x((0,s.__)("Please select a voice profile.","ai-tools-for-wp"))},disabled:d||!i,className:"aitwp-rewrite-button",children:d?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(m.Spinner,{}),(0,s.__)("Rewriting...","ai-tools-for-wp")]}):(0,s.__)("Rewrite Content","ai-tools-for-wp")})]}),w&&(0,o.jsxs)(m.Modal,{title:(0,s.__)("Rewritten Content Preview","ai-tools-for-wp"),onRequestClose:b,className:"aitwp-preview-modal",size:"large",children:[(0,o.jsxs)("p",{className:"aitwp-preview-info",children:[(0,s.__)("Using voice profile:","ai-tools-for-wp")," ",(0,o.jsx)("strong",{children:(()=>{const t=e.find(e=>e.id===i);return t?.name||""})()})]}),(0,o.jsx)(m.TextareaControl,{label:(0,s.__)("Preview","ai-tools-for-wp"),value:p,onChange:g,rows:15,className:"aitwp-preview-textarea",help:(0,s.__)("You can edit the content before accepting.","ai-tools-for-wp")}),(0,o.jsxs)("div",{className:"aitwp-preview-actions",children:[(0,o.jsx)(m.Button,{variant:"primary",onClick:()=>{v({content:p}),h(!1),g("")},children:(0,s.__)("Accept & Replace","ai-tools-for-wp")}),(0,o.jsx)(m.Button,{variant:"secondary",onClick:b,children:(0,s.__)("Reject","ai-tools-for-wp")})]})]})]})};(0,t.registerPlugin)("ai-tools-for-wp",{render:()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.PluginSidebarMoreMenuItem,{target:"ai-tools-sidebar",children:(0,s.__)("AI Tools","ai-tools-for-wp")}),(0,o.jsx)(i.PluginSidebar,{name:"ai-tools-sidebar",title:(0,s.__)("AI Tools","ai-tools-for-wp"),icon:a,children:(0,o.jsxs)("div",{className:"aitwp-sidebar",children:[(0,o.jsx)(j,{panelTitle:(0,s.__)("Target Audience","ai-tools-for-wp"),children:(0,o.jsx)(v,{})}),(0,o.jsx)(j,{panelTitle:(0,s.__)("Auto-Categorize","ai-tools-for-wp"),children:(0,o.jsx)(C,{})}),(0,o.jsx)(j,{panelTitle:(0,s.__)("Rewrite Content","ai-tools-for-wp"),children:(0,o.jsx)(b,{})})]})})]}),icon:a})})();