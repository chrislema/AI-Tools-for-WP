(()=>{"use strict";var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.plugins,i=window.wp.editPost,s=window.wp.i18n,a=window.wp.primitives,o=window.ReactJSXRuntime;var n=(0,o.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,o.jsx)(a.Path,{d:"M11.776 4.454a.25.25 0 01.448 0l2.069 4.192a.25.25 0 00.188.137l4.626.672a.25.25 0 01.139.426l-3.348 3.263a.25.25 0 00-.072.222l.79 4.607a.25.25 0 01-.362.263l-4.138-2.175a.25.25 0 00-.232 0l-4.138 2.175a.25.25 0 01-.363-.263l.79-4.607a.25.25 0 00-.071-.222L4.754 9.881a.25.25 0 01.139-.426l4.626-.672a.25.25 0 00.188-.137l2.069-4.192z"})});const l=window.wp.element,r=window.wp.data,c=window.wp.components,d=window.wp.apiFetch;var p=e.n(d);const u="/ai-tools/v1",w=()=>{const[e,t]=(0,l.useState)([]),[i,a]=(0,l.useState)(""),[n,d]=(0,l.useState)(!0),[w,g]=(0,l.useState)(!1),[h,_]=(0,l.useState)(null),[f,m]=(0,l.useState)(null),x=(0,r.useSelect)(e=>{const{getEditedPostContent:t}=e("core/editor");return t()},[]);(0,l.useEffect)(()=>{j()},[]);const j=async()=>{try{d(!0),m(null);const e=await(async()=>p()({path:`${u}/audiences`,method:"GET"}))(),i=Object.values(e||{});t(i)}catch(e){m(e.message||(0,s.__)("Failed to load audiences.","ai-tools-for-wp"))}finally{d(!1)}};return(0,l.useEffect)(()=>{window.aitwpSelectedAudience=i},[i]),n?(0,o.jsx)(c.PanelBody,{title:(0,s.__)("Target Audience","ai-tools-for-wp"),initialOpen:!0,children:(0,o.jsxs)("div",{className:"aitwp-loading",children:[(0,o.jsx)(c.Spinner,{}),(0,o.jsx)("span",{children:(0,s.__)("Loading audiences...","ai-tools-for-wp")})]})}):0===e.length?(0,o.jsx)(c.PanelBody,{title:(0,s.__)("Target Audience","ai-tools-for-wp"),initialOpen:!0,children:(0,o.jsx)(c.Notice,{status:"info",isDismissible:!1,children:(0,s.__)("No audiences defined. Add audiences in Settings → AI Tools.","ai-tools-for-wp")})}):(0,o.jsxs)(c.PanelBody,{title:(0,s.__)("Target Audience","ai-tools-for-wp"),initialOpen:!0,children:[f&&(0,o.jsx)(c.Notice,{status:"error",isDismissible:!0,onDismiss:()=>m(null),children:f}),(0,o.jsx)(c.SelectControl,{label:(0,s.__)("Select Audience","ai-tools-for-wp"),value:i,options:(()=>{const t=[{value:"",label:(0,s.__)("— Select Audience —","ai-tools-for-wp")}];return e.forEach(e=>{t.push({value:e.id,label:e.name})}),t})(),onChange:e=>{a(e),_(null)}}),(0,o.jsx)(c.Button,{variant:"secondary",onClick:async()=>{if(!x||x.trim().length<50)m((0,s.__)("Please add more content before requesting a suggestion.","ai-tools-for-wp"));else try{g(!0),m(null),_(null);const e=await(async e=>p()({path:`${u}/suggest-audience`,method:"POST",data:{content:e}}))(x);_(e),e.audience_id&&a(e.audience_id)}catch(e){m(e.message||(0,s.__)("Failed to get suggestion.","ai-tools-for-wp"))}finally{g(!1)}},disabled:w,className:"aitwp-suggest-button",children:w?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.Spinner,{}),(0,s.__)("Analyzing...","ai-tools-for-wp")]}):(0,s.__)("Suggest Audience","ai-tools-for-wp")}),h&&(0,o.jsxs)("div",{className:"aitwp-suggestion",children:[(0,o.jsx)("p",{className:"aitwp-suggestion-label",children:(0,s.__)("AI Suggestion:","ai-tools-for-wp")}),(0,o.jsxs)("p",{className:"aitwp-suggestion-value",children:[(0,o.jsx)("strong",{children:h.audience?.name}),h.confidence&&(0,o.jsx)("span",{className:"aitwp-confidence",children:` (${h.confidence}% match)`})]}),h.reasoning&&(0,o.jsx)("p",{className:"aitwp-suggestion-reasoning",children:h.reasoning})]})]})},g=()=>{const[e,t]=(0,l.useState)(!1),[i,a]=(0,l.useState)(null),[n,d]=(0,l.useState)([]),[w,g]=(0,l.useState)([]),[h,_]=(0,l.useState)(window.aitwpData?.autoApply||!1),[f,m]=(0,l.useState)(null),{postContent:x,currentCategories:j,currentTags:y}=(0,r.useSelect)(e=>{const t=e("core/editor");return{postContent:t.getEditedPostContent(),currentCategories:t.getEditedPostAttribute("categories")||[],currentTags:t.getEditedPostAttribute("tags")||[]}},[]),{editPost:v}=(0,r.useDispatch)("core/editor");return(0,o.jsxs)(c.PanelBody,{title:(0,s.__)("Auto-Categorize","ai-tools-for-wp"),initialOpen:!1,children:[f&&(0,o.jsx)(c.Notice,{status:"error",isDismissible:!0,onDismiss:()=>m(null),children:f}),(0,o.jsx)("p",{className:"aitwp-panel-description",children:(0,s.__)("Analyze your content to get AI-suggested categories and tags.","ai-tools-for-wp")}),(0,o.jsx)(c.ToggleControl,{label:(0,s.__)("Auto-apply suggestions","ai-tools-for-wp"),checked:h,onChange:_,help:(0,s.__)("Automatically apply suggestions when analyzing.","ai-tools-for-wp")}),(0,o.jsx)(c.Button,{variant:"primary",onClick:async()=>{if(!x||x.trim().length<50)m((0,s.__)("Please add more content before analyzing.","ai-tools-for-wp"));else try{t(!0),m(null),a(null);const e=window.aitwpSelectedAudience||"",i=await(async(e,t="")=>p()({path:`${u}/categorize`,method:"POST",data:{content:e,audience_id:t}}))(x,e);a(i),d(i.categories?.map(e=>e.id)||[]),g(i.tags?.map(e=>e.id)||[]),h&&(e=>{const t=e.categories?.map(e=>e.id)||[],i=e.tags?.map(e=>e.id)||[],s=[...new Set([...j,...t])],a=[...new Set([...y,...i])];v({categories:s,tags:a})})(i)}catch(e){m(e.message||(0,s.__)("Failed to analyze content.","ai-tools-for-wp"))}finally{t(!1)}},disabled:e,className:"aitwp-analyze-button",children:e?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.Spinner,{}),(0,s.__)("Analyzing...","ai-tools-for-wp")]}):(0,s.__)("Analyze Content","ai-tools-for-wp")}),i&&(0,o.jsxs)("div",{className:"aitwp-suggestions",children:[i.reasoning&&(0,o.jsx)("p",{className:"aitwp-reasoning",children:i.reasoning}),i.categories?.length>0&&(0,o.jsxs)("div",{className:"aitwp-suggestion-group",children:[(0,o.jsx)("h4",{children:(0,s.__)("Suggested Categories","ai-tools-for-wp")}),i.categories.map(e=>(0,o.jsx)(c.CheckboxControl,{label:e.name,checked:n.includes(e.id),onChange:()=>{return t=e.id,void d(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t}},e.id))]}),i.tags?.length>0&&(0,o.jsxs)("div",{className:"aitwp-suggestion-group",children:[(0,o.jsx)("h4",{children:(0,s.__)("Suggested Tags","ai-tools-for-wp")}),i.tags.map(e=>(0,o.jsx)(c.CheckboxControl,{label:e.name,checked:w.includes(e.id),onChange:()=>{return t=e.id,void g(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t}},e.id))]}),i.new_tags?.length>0&&(0,o.jsxs)("div",{className:"aitwp-suggestion-group",children:[(0,o.jsx)("h4",{children:(0,s.__)("Suggested New Tags","ai-tools-for-wp")}),(0,o.jsx)("p",{className:"aitwp-new-tags-note",children:(0,s.__)("These tags don't exist yet:","ai-tools-for-wp")}),(0,o.jsx)("ul",{className:"aitwp-new-tags-list",children:i.new_tags.map((e,t)=>(0,o.jsx)("li",{children:e},t))})]}),!h&&(0,o.jsxs)("div",{className:"aitwp-suggestion-actions",children:[(0,o.jsx)(c.Button,{variant:"primary",onClick:()=>{const e=[...new Set([...j,...n])],t=[...new Set([...y,...w])];v({categories:e,tags:t}),a(null)},disabled:0===n.length&&0===w.length,children:(0,s.__)("Apply Selected","ai-tools-for-wp")}),(0,o.jsx)(c.Button,{variant:"tertiary",onClick:()=>{a(null),d([]),g([])},children:(0,s.__)("Dismiss","ai-tools-for-wp")})]})]})]})},h=()=>{const[e,t]=(0,l.useState)([]),[i,a]=(0,l.useState)(""),[n,d]=(0,l.useState)(!0),[w,g]=(0,l.useState)(!1),[h,_]=(0,l.useState)(""),[f,m]=(0,l.useState)(!1),[x,j]=(0,l.useState)(null),y=(0,r.useSelect)(e=>e("core/editor").getEditedPostContent(),[]),{editPost:v}=(0,r.useDispatch)("core/editor");(0,l.useEffect)(()=>{S()},[]);const S=async()=>{try{d(!0),j(null);const e=await(async()=>p()({path:`${u}/voice-profiles`,method:"GET"}))(),i=Object.values(e||{});t(i),i.length>0&&a(i[0].id)}catch(e){j(e.message||(0,s.__)("Failed to load voice profiles.","ai-tools-for-wp"))}finally{d(!1)}},b=()=>{m(!1),_("")};return n?(0,o.jsx)(c.PanelBody,{title:(0,s.__)("Rewrite Content","ai-tools-for-wp"),initialOpen:!1,children:(0,o.jsxs)("div",{className:"aitwp-loading",children:[(0,o.jsx)(c.Spinner,{}),(0,o.jsx)("span",{children:(0,s.__)("Loading voice profiles...","ai-tools-for-wp")})]})}):0===e.length?(0,o.jsx)(c.PanelBody,{title:(0,s.__)("Rewrite Content","ai-tools-for-wp"),initialOpen:!1,children:(0,o.jsx)(c.Notice,{status:"info",isDismissible:!1,children:(0,s.__)("No voice profiles defined. Add profiles in Settings → AI Tools.","ai-tools-for-wp")})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(c.PanelBody,{title:(0,s.__)("Rewrite Content","ai-tools-for-wp"),initialOpen:!1,children:[x&&(0,o.jsx)(c.Notice,{status:"error",isDismissible:!0,onDismiss:()=>j(null),children:x}),(0,o.jsx)("p",{className:"aitwp-panel-description",children:(0,s.__)("Rewrite your content using a voice profile to match your desired tone and style.","ai-tools-for-wp")}),(0,o.jsx)(c.SelectControl,{label:(0,s.__)("Voice Profile","ai-tools-for-wp"),value:i,options:e.map(e=>({value:e.id,label:e.name})),onChange:a}),(0,o.jsx)(c.Button,{variant:"primary",onClick:async()=>{if(!y||y.trim().length<50)j((0,s.__)("Please add more content before rewriting.","ai-tools-for-wp"));else if(i)try{g(!0),j(null),_("");const e=window.aitwpSelectedAudience||"",t=await(async(e,t,i="")=>p()({path:`${u}/rewrite`,method:"POST",data:{content:e,voice_profile_id:t,audience_id:i}}))(y,i,e);t.rewritten_content&&(_(t.rewritten_content),m(!0))}catch(e){j(e.message||(0,s.__)("Failed to rewrite content.","ai-tools-for-wp"))}finally{g(!1)}else j((0,s.__)("Please select a voice profile.","ai-tools-for-wp"))},disabled:w||!i,className:"aitwp-rewrite-button",children:w?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.Spinner,{}),(0,s.__)("Rewriting...","ai-tools-for-wp")]}):(0,s.__)("Rewrite Content","ai-tools-for-wp")})]}),f&&(0,o.jsxs)(c.Modal,{title:(0,s.__)("Rewritten Content Preview","ai-tools-for-wp"),onRequestClose:b,className:"aitwp-preview-modal",size:"large",children:[(0,o.jsxs)("p",{className:"aitwp-preview-info",children:[(0,s.__)("Using voice profile:","ai-tools-for-wp")," ",(0,o.jsx)("strong",{children:(()=>{const t=e.find(e=>e.id===i);return t?.name||""})()})]}),(0,o.jsx)(c.TextareaControl,{label:(0,s.__)("Preview","ai-tools-for-wp"),value:h,onChange:_,rows:15,className:"aitwp-preview-textarea",help:(0,s.__)("You can edit the content before accepting.","ai-tools-for-wp")}),(0,o.jsxs)("div",{className:"aitwp-preview-actions",children:[(0,o.jsx)(c.Button,{variant:"primary",onClick:()=>{v({content:h}),m(!1),_("")},children:(0,s.__)("Accept & Replace","ai-tools-for-wp")}),(0,o.jsx)(c.Button,{variant:"secondary",onClick:b,children:(0,s.__)("Reject","ai-tools-for-wp")})]})]})]})};(0,t.registerPlugin)("ai-tools-for-wp",{render:()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.PluginSidebarMoreMenuItem,{target:"ai-tools-sidebar",children:(0,s.__)("AI Tools","ai-tools-for-wp")}),(0,o.jsx)(i.PluginSidebar,{name:"ai-tools-sidebar",title:(0,s.__)("AI Tools","ai-tools-for-wp"),icon:n,children:(0,o.jsxs)("div",{className:"aitwp-sidebar",children:[(0,o.jsx)(w,{}),(0,o.jsx)(g,{}),(0,o.jsx)(h,{})]})})]}),icon:n})})();